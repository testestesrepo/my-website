<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Simple WebAR App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- A-Frame -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/AR.js/3.4.5/aframe-ar.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
            pointer-events: auto;
        }
        
        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            pointer-events: auto;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            min-width: 60px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .btn:active {
            background: #45a049;
            transform: scale(0.95);
        }
        
        .btn.red {
            background: #f44336;
        }
        
        .btn.red:active {
            background: #da190b;
        }
        
        #debugInfo {
            position: absolute;
            top: 120px;
            left: 20px;
            right: 20px;
            background: rgba(0, 100, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            pointer-events: auto;
            display: none;
        }
    </style>
</head>
<body>
    <!-- UI Layer -->
    <div id="ui">
        <div id="info">
            <h3>üéØ WebAR „ÉÜ„Çπ„Éà</h3>
            <p id="status">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
            <button id="debugBtn" class="btn" onclick="toggleDebug()">„Éá„Éê„ÉÉ„Ç∞</button>
        </div>
        
        <div id="debugInfo"></div>
        
        <div id="controls">
            <button class="btn" onclick="addCube()">üì¶ „Ç≠„É•„Éº„Éñ</button>
            <button class="btn" onclick="addSphere()">‚öΩ ÁêÉ‰Ωì</button>
            <button class="btn" onclick="addCylinder()">ü•§ ÂÜÜÊü±</button>
            <button class="btn red" onclick="clearAll()">üóëÔ∏è „ÇØ„É™„Ç¢</button>
        </div>
    </div>
    
    <!-- A-Frame Scene -->
    <a-scene
        id="scene"
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false"
        embedded
        renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true;"
        background="transparent">
        
        <!-- Assets -->
        <a-assets>
            <!-- Preload materials -->
            <a-mixin id="cube-mixin" 
                geometry="primitive: box; width: 0.4; height: 0.4; depth: 0.4"
                material="color: #FF6B6B; metalness: 0.2; roughness: 0.8"
                shadow="cast: true; receive: true">
            </a-mixin>
            <a-mixin id="sphere-mixin"
                geometry="primitive: sphere; radius: 0.2"
                material="color: #4ECDC4; metalness: 0.1; roughness: 0.9"
                shadow="cast: true; receive: true">
            </a-mixin>
            <a-mixin id="cylinder-mixin"
                geometry="primitive: cylinder; radius: 0.15; height: 0.6"
                material="color: #96CEB4; metalness: 0.3; roughness: 0.7"
                shadow="cast: true; receive: true">
            </a-mixin>
        </a-assets>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#404040" intensity="0.5"></a-light>
        <a-light type="directional" position="1 4 3" color="#ffffff" intensity="0.8" shadow="cast: true"></a-light>
        <a-light type="point" position="0 2 0" color="#ffffff" intensity="0.3"></a-light>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
        
        <!-- Ground plane (invisible but receives shadows) -->
        <a-plane position="0 -1 0" rotation="-90 0 0" width="20" height="20" 
                 material="color: white; transparent: true; opacity: 0.1" 
                 shadow="receive: true"></a-plane>
        
        <!-- Default objects for testing -->
        <a-box id="testCube" 
               position="0 0.5 -1.5" 
               color="#FF6B6B" 
               shadow="cast: true"
               animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
        </a-box>
        
        <a-sphere id="testSphere" 
                  position="0.8 0.7 -2" 
                  radius="0.2" 
                  color="#4ECDC4" 
                  shadow="cast: true"
                  animation="property: position; to: 0.8 1.2 -2; direction: alternate; loop: true; dur: 2000">
        </a-sphere>
        
        <a-cylinder id="testCylinder" 
                    position="-0.8 0.5 -2" 
                    radius="0.15" 
                    height="0.6" 
                    color="#96CEB4" 
                    shadow="cast: true"
                    animation="property: rotation; to: 0 0 360; loop: true; dur: 3000">
        </a-cylinder>
    </a-scene>

    <script>
        let scene;
        let objectCount = 0;
        let debugMode = false;
        let debugLog = [];
        
        // Logging function
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            console.log(logEntry);
            debugLog.push(logEntry);
            
            // Keep only last 20 log entries
            if (debugLog.length > 20) {
                debugLog.shift();
            }
            
            updateDebugDisplay();
        }
        
        // Update debug display
        function updateDebugDisplay() {
            if (debugMode) {
                const debugDiv = document.getElementById('debugInfo');
                debugDiv.innerHTML = debugLog.join('<br>');
                debugDiv.scrollTop = debugDiv.scrollHeight;
            }
        }
        
        // Toggle debug panel
        function toggleDebug() {
            debugMode = !debugMode;
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.style.display = debugMode ? 'block' : 'none';
            
            if (debugMode) {
                log('Debug mode enabled');
                checkSceneStatus();
            }
        }
        
        // Check scene status
        function checkSceneStatus() {
            if (scene) {
                const entities = scene.querySelectorAll('a-entity, a-box, a-sphere, a-cylinder');
                log(`Scene loaded. Total entities: ${entities.length}`);
                
                // Check camera
                const camera = scene.querySelector('[camera]');
                if (camera) {
                    log('Camera found');
                } else {
                    log('WARNING: No camera found');
                }
                
                // Check AR.js status
                if (scene.systems && scene.systems.arjs) {
                    log('AR.js system detected');
                } else {
                    log('WARNING: AR.js system not detected');
                }
            } else {
                log('ERROR: Scene not initialized');
            }
        }
        
        // Add cube
        function addCube() {
            if (!scene) {
                log('ERROR: Scene not ready');
                return;
            }
            
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const cube = document.createElement('a-box');
            const x = (Math.random() - 0.5) * 3;
            const y = Math.random() * 0.5 + 0.2;
            const z = -1 - Math.random() * 2;
            
            cube.setAttribute('position', `${x} ${y} ${z}`);
            cube.setAttribute('color', randomColor);
            cube.setAttribute('shadow', 'cast: true');
            cube.setAttribute('width', '0.4');
            cube.setAttribute('height', '0.4');
            cube.setAttribute('depth', '0.4');
            cube.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 4000');
            cube.setAttribute('id', `cube-${objectCount++}`);
            
            scene.appendChild(cube);
            log(`Added cube at position: ${x.toFixed(1)}, ${y.toFixed(1)}, ${z.toFixed(1)}`);
        }
        
        // Add sphere
        function addSphere() {
            if (!scene) {
                log('ERROR: Scene not ready');
                return;
            }
            
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const sphere = document.createElement('a-sphere');
            const x = (Math.random() - 0.5) * 3;
            const y = Math.random() * 0.5 + 0.2;
            const z = -1 - Math.random() * 2;
            
            sphere.setAttribute('position', `${x} ${y} ${z}`);
            sphere.setAttribute('color', randomColor);
            sphere.setAttribute('shadow', 'cast: true');
            sphere.setAttribute('radius', '0.2');
            sphere.setAttribute('animation', 'property: position; to: ' + x + ' ' + (y + 0.5) + ' ' + z + '; direction: alternate; loop: true; dur: 2500');
            sphere.setAttribute('id', `sphere-${objectCount++}`);
            
            scene.appendChild(sphere);
            log(`Added sphere at position: ${x.toFixed(1)}, ${y.toFixed(1)}, ${z.toFixed(1)}`);
        }
        
        // Add cylinder
        function addCylinder() {
            if (!scene) {
                log('ERROR: Scene not ready');
                return;
            }
            
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            const cylinder = document.createElement('a-cylinder');
            const x = (Math.random() - 0.5) * 3;
            const y = Math.random() * 0.3 + 0.3;
            const z = -1 - Math.random() * 2;
            
            cylinder.setAttribute('position', `${x} ${y} ${z}`);
            cylinder.setAttribute('color', randomColor);
            cylinder.setAttribute('shadow', 'cast: true');
            cylinder.setAttribute('radius', '0.15');
            cylinder.setAttribute('height', '0.6');
            cylinder.setAttribute('animation', 'property: rotation; to: 0 0 360; loop: true; dur: 3500');
            cylinder.setAttribute('id', `cylinder-${objectCount++}`);
            
            scene.appendChild(cylinder);
            log(`Added cylinder at position: ${x.toFixed(1)}, ${y.toFixed(1)}, ${z.toFixed(1)}`);
        }
        
        // Clear all objects
        function clearAll() {
            if (!scene) {
                log('ERROR: Scene not ready');
                return;
            }
            
            const userObjects = scene.querySelectorAll('[id^="cube-"], [id^="sphere-"], [id^="cylinder-"]');
            userObjects.forEach((obj, index) => {
                obj.remove();
            });
            
            log(`Cleared ${userObjects.length} user objects`);
            objectCount = 0;
        }
        
        // Update status
        function updateStatus(message) {
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.textContent = message;
            }
            log(message);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('DOM loaded');
            updateStatus('ÂàùÊúüÂåñ‰∏≠...');
            
            // Wait for A-Frame to load
            if (typeof AFRAME !== 'undefined') {
                initializeAR();
            } else {
                log('Waiting for A-Frame...');
                setTimeout(initializeAR, 1000);
            }
        });
        
        // Initialize AR
        function initializeAR() {
            scene = document.querySelector('a-scene');
            
            if (!scene) {
                log('ERROR: Scene element not found');
                updateStatus('„Ç®„É©„Éº: „Ç∑„Éº„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            log('Scene element found');
            
            // Wait for scene to be ready
            if (scene.hasLoaded) {
                onSceneReady();
            } else {
                scene.addEventListener('loaded', onSceneReady);
            }
            
            // Add error handling
            scene.addEventListener('renderstart', () => {
                log('Render started');
            });
            
            // Check for AR.js
            setTimeout(() => {
                if (window.ARjs) {
                    log('AR.js library loaded');
                    updateStatus('„Ç´„É°„É©Ê∫ñÂÇô‰∏≠...');
                } else {
                    log('WARNING: AR.js not detected');
                    updateStatus('AR.jsË™≠„ÅøËæº„Åø„Ç®„É©„Éº');
                }
            }, 2000);
        }
        
        // Scene ready callback
        function onSceneReady() {
            log('Scene ready');
            updateStatus('ARÊ∫ñÂÇôÂÆå‰∫Ü - „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            
            // Add some test visibility
            setTimeout(() => {
                const testObjects = scene.querySelectorAll('#testCube, #testSphere, #testCylinder');
                log(`Test objects visible: ${testObjects.length}`);
                
                if (testObjects.length === 0) {
                    log('WARNING: Test objects not found');
                }
            }, 1000);
        }
        
        // Handle errors
        window.addEventListener('error', (event) => {
            log(`JavaScript Error: ${event.error?.message || event.message}`);
        });
        
        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            log(`Promise Rejection: ${event.reason}`);
        });
        
        log('Script loaded');
    </script>
</body>
</html>