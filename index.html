<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Complete WebXR AR Demo</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-ar-hit-test@1.0.2/dist/aframe-ar-hit-test.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: sans-serif;
      }
      #gui {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 999;
        background: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 8px;
      }
      #gui button {
        margin: 5px;
        padding: 8px 12px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <!-- GUI -->
    <div id="gui">
      <button id="cubeButton">Cube</button>
      <button id="sphereButton">Sphere</button>
    </div>

    <!-- A-Frame Scene -->
    <a-scene
      xr="mode: ar;"
      renderer="colorManagement: true; physicallyCorrectLights: true;"
      embedded
    >
      <!-- 環境光 -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>

      <!-- ヒットテスト用ターゲット -->
      <a-entity id="hitTestEntity" ar-hit-test="target: #placementMarker; target-visible: false;"></a-entity>

      <!-- ヒットターゲット位置表示用のマーカー（非表示にして使う） -->
      <a-sphere
        id="placementMarker"
        visible="false"
        radius="0.01"
        color="#FFFFFF"
      ></a-sphere>

      <!-- カメラ -->
      <a-camera></a-camera>
    </a-scene>

    <!-- JS -->
    <script>
      let currentShape = 'box'; // 初期はbox
      const scene = document.querySelector('a-scene');
      const marker = document.querySelector('#placementMarker');

      // GUIボタン設定
      document.getElementById('cubeButton').addEventListener('click', () => {
        currentShape = 'box';
      });

      document.getElementById('sphereButton').addEventListener('click', () => {
        currentShape = 'sphere';
      });

      // タップ時の配置
      scene.addEventListener('click', () => {
        const position = marker.getAttribute('position');
        let newEntity;

        if (currentShape === 'box') {
          newEntity = document.createElement('a-box');
          newEntity.setAttribute('depth', '0.5');
          newEntity.setAttribute('height', '0.5');
          newEntity.setAttribute('width', '0.5');
        } else if (currentShape === 'sphere') {
          newEntity = document.createElement('a-sphere');
          newEntity.setAttribute('radius', '0.25');
        }

        newEntity.setAttribute('position', position);
        newEntity.setAttribute('color', '#'+Math.floor(Math.random()*16777215).toString(16));
        newEntity.setAttribute('shadow', 'receive: true; cast: true;');
        newEntity.setAttribute('animation__scale', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 500; easing: easeOutElastic');

        scene.appendChild(newEntity);
      });
    </script>
  </body>
</html>
