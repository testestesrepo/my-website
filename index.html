<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«ãƒãƒ¼ã‚«ãƒ¼ãƒ¬ã‚¹AR</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #000;
            overflow: hidden;
        }
        
        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: 1;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 2;
            pointer-events: none;
        }
        
        #ui {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        #controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
        }
        
        .control-btn {
            padding: 15px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .control-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .control-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .control-btn.secondary {
            background: #FF6B6B;
        }
        
        .control-btn.secondary:hover {
            background: #ff5252;
        }
        
        #status {
            position: fixed;
            bottom: 120px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
        }
        
        .hidden {
            display: none !important;
        }
        
        #instructions {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 2000;
            max-width: 90vw;
        }
        
        #startBtn {
            margin-top: 20px;
            padding: 15px 30px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="instructions">
        <h2>ğŸ“± ãƒãƒ¼ã‚«ãƒ¼ãƒ¬ã‚¹AR</h2>
        <p>ã‚«ãƒ¡ãƒ©ã‚’ä½¿ã£ã¦3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã—ã¾ã™</p>
        <ul style="text-align: left; margin: 15px 0;">
            <li>ğŸ¯ ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…ç½®</li>
            <li>ğŸ”„ é…ç½®ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¿ãƒƒãƒ—ã§å‰Šé™¤</li>
            <li>ğŸ¨ è¤‡æ•°ã®å½¢çŠ¶ãŒãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®ã•ã‚Œã¾ã™</li>
        </ul>
        <button id="startBtn">ARã‚’é–‹å§‹</button>
    </div>
    
    <video id="video" autoplay muted playsinline></video>
    <canvas id="canvas"></canvas>
    
    <div id="ui">
        <h3>ğŸŒŸ ãƒãƒ¼ã‚«ãƒ¼ãƒ¬ã‚¹AR</h3>
        <p>ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ•°: <span id="objectCount">0</span></p>
    </div>
    
    <div id="controls" class="hidden">
        <button class="control-btn" id="placeBtn">ğŸ¯ é…ç½®</button>
        <button class="control-btn secondary" id="clearBtn">ğŸ—‘ï¸ å…¨å‰Šé™¤</button>
    </div>
    
    <div id="status" class="hidden">
        ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã—ã¦ãã ã•ã„
    </div>

    <script>
        let video, canvas, ctx;
        let isARActive = false;
        let objects = [];
        let objectIdCounter = 0;
        
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡å®šç¾©
        const objectTypes = [
            { type: 'cube', color: '#FF6B6B', size: 40 },
            { type: 'circle', color: '#4ECDC4', size: 35 },
            { type: 'triangle', color: '#FFE66D', size: 45 },
            { type: 'diamond', color: '#95E1D3', size: 40 },
            { type: 'star', color: '#F38BA8', size: 50 }
        ];
        
        // DOMè¦ç´ ã®å–å¾—
        const instructionsDiv = document.getElementById('instructions');
        const startBtn = document.getElementById('startBtn');
        const ui = document.getElementById('ui');
        const controls = document.getElementById('controls');
        const status = document.getElementById('status');
        const placeBtn = document.getElementById('placeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const objectCountSpan = document.getElementById('objectCount');
        
        // åˆæœŸåŒ–
        function init() {
            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã®è¨­å®š
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            startBtn.addEventListener('click', startAR);
            placeBtn.addEventListener('click', placeRandomObject);
            clearBtn.addEventListener('click', clearAllObjects);
            canvas.addEventListener('click', handleCanvasClick);
            
            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼‰
            canvas.addEventListener('touchstart', handleTouch);
        }
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºèª¿æ•´
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        // ARã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
        async function startAR() {
            try {
                // ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹è¦æ±‚
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: 'environment', // èƒŒé¢ã‚«ãƒ¡ãƒ©
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                video.srcObject = stream;
                video.play();
                
                // UIåˆ‡ã‚Šæ›¿ãˆ
                instructionsDiv.classList.add('hidden');
                controls.classList.remove('hidden');
                status.classList.remove('hidden');
                
                isARActive = true;
                
                // æç”»ãƒ«ãƒ¼ãƒ—é–‹å§‹
                requestAnimationFrame(render);
                
                status.textContent = 'âœ… ARãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®';
                
            } catch (error) {
                console.error('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:', error);
                alert('ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        // ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—
        function render() {
            if (!isARActive) return;
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»
            objects.forEach(obj => {
                drawObject(obj);
            });
            
            requestAnimationFrame(render);
        }
        
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæç”»
        function drawObject(obj) {
            ctx.save();
            ctx.translate(obj.x, obj.y);
            ctx.rotate(obj.rotation);
            
            // å½±ã®åŠ¹æœ
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 5;
            ctx.shadowOffsetY = 5;
            
            ctx.fillStyle = obj.color;
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            
            switch(obj.type) {
                case 'cube':
                    drawCube(obj.size);
                    break;
                case 'circle':
                    drawCircle(obj.size);
                    break;
                case 'triangle':
                    drawTriangle(obj.size);
                    break;
                case 'diamond':
                    drawDiamond(obj.size);
                    break;
                case 'star':
                    drawStar(obj.size);
                    break;
            }
            
            ctx.restore();
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
            obj.rotation += obj.rotationSpeed;
            obj.scale = 1 + Math.sin(obj.animationTime) * 0.1;
            obj.animationTime += 0.05;
        }
        
        // å„å½¢çŠ¶ã®æç”»é–¢æ•°
        function drawCube(size) {
            const s = size / 2;
            ctx.fillRect(-s, -s, size, size);
            ctx.strokeRect(-s, -s, size, size);
        }
        
        function drawCircle(size) {
            ctx.beginPath();
            ctx.arc(0, 0, size / 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
        }
        
        function drawTriangle(size) {
            const s = size / 2;
            ctx.beginPath();
            ctx.moveTo(0, -s);
            ctx.lineTo(-s, s);
            ctx.lineTo(s, s);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }
        
        function drawDiamond(size) {
            const s = size / 2;
            ctx.beginPath();
            ctx.moveTo(0, -s);
            ctx.lineTo(s, 0);
            ctx.lineTo(0, s);
            ctx.lineTo(-s, 0);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }
        
        function drawStar(size) {
            const s = size / 2;
            ctx.beginPath();
            for (let i = 0; i < 5; i++) {
                const angle = (i * 4 * Math.PI) / 5;
                const x = Math.cos(angle) * s;
                const y = Math.sin(angle) * s;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…ç½®
        function placeRandomObject() {
            const objType = objectTypes[Math.floor(Math.random() * objectTypes.length)];
            const x = Math.random() * (canvas.width - 100) + 50;
            const y = Math.random() * (canvas.height - 200) + 100;
            
            addObject(x, y, objType);
        }
        
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¿½åŠ 
        function addObject(x, y, objType) {
            const obj = {
                id: ++objectIdCounter,
                x: x,
                y: y,
                type: objType.type,
                color: objType.color,
                size: objType.size,
                rotation: 0,
                rotationSpeed: (Math.random() - 0.5) * 0.1,
                scale: 1,
                animationTime: 0
            };
            
            objects.push(obj);
            updateObjectCount();
            
            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            status.textContent = `ğŸ‰ ${obj.type}ã‚’é…ç½®ã—ã¾ã—ãŸï¼ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¿ãƒƒãƒ—ã§å‰Šé™¤ï¼‰`;
            setTimeout(() => {
                status.textContent = 'ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã—ã¦ãã ã•ã„';
            }, 2000);
        }
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
        function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
            const clickedObject = findObjectAt(x, y);
            if (clickedObject) {
                removeObject(clickedObject.id);
            } else {
                // æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®
                const objType = objectTypes[Math.floor(Math.random() * objectTypes.length)];
                addObject(x, y, objType);
            }
        }
        
        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
        function handleTouch(event) {
            event.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = event.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            const clickedObject = findObjectAt(x, y);
            if (clickedObject) {
                removeObject(clickedObject.id);
            } else {
                const objType = objectTypes[Math.floor(Math.random() * objectTypes.length)];
                addObject(x, y, objType);
            }
        }
        
        // åº§æ¨™ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢
        function findObjectAt(x, y) {
            for (let i = objects.length - 1; i >= 0; i--) {
                const obj = objects[i];
                const distance = Math.sqrt((x - obj.x) ** 2 + (y - obj.y) ** 2);
                if (distance < obj.size / 2) {
                    return obj;
                }
            }
            return null;
        }
        
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤
        function removeObject(id) {
            objects = objects.filter(obj => obj.id !== id);
            updateObjectCount();
            status.textContent = 'ğŸ—‘ï¸ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ';
            setTimeout(() => {
                status.textContent = 'ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã—ã¦ãã ã•ã„';
            }, 1500);
        }
        
        // å…¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤
        function clearAllObjects() {
            objects = [];
            updateObjectCount();
            status.textContent = 'ğŸ§¹ ã™ã¹ã¦ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ';
            setTimeout(() => {
                status.textContent = 'ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã—ã¦ãã ã•ã„';
            }, 2000);
        }
        
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
        function updateObjectCount() {
            objectCountSpan.textContent = objects.length;
        }
        
        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.addEventListener('load', init);
    </script>
</body>
</html>